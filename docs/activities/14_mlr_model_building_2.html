<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Multiple linear regression: model building (part 2) – STAT 155</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">STAT 155</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-activities" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Activities</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-activities">    
        <li>
    <a class="dropdown-item" href="../activities/01_foundations_welcome.html">
 <span class="dropdown-text">Data Fundamentals</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/02_foundations_univariate.html">
 <span class="dropdown-text">Univariate visualization and summaries</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/03_slr_introduction.html">
 <span class="dropdown-text">Simple linear regression: Visualization and Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/04_slr_formalization.html">
 <span class="dropdown-text">Simple linear regression: formalizing concepts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/05_slr_model_eval.html">
 <span class="dropdown-text">Simple linear regression: model evaluation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/06_slr_transformations.html">
 <span class="dropdown-text">Simple linear regression: Transformations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/07_slr_cat_predictor.html">
 <span class="dropdown-text">Simple linear regression: categorical predictor</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/08_mlr_intro.html">
 <span class="dropdown-text">Introduction to multiple regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/09_mlr_principles.html">
 <span class="dropdown-text">Multiple regression principles</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/10_mlr_confounding.html">
 <span class="dropdown-text">Confounding variables</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/11_mlr_interaction_explore.html">
 <span class="dropdown-text">Multiple linear regression: exploring interaction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/12_mlr_interaction_practice.html">
 <span class="dropdown-text">Multiple linear regression: interaction terms practice</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/13_mlr_model_building_1.html">
 <span class="dropdown-text">Multiple linear regression: model building (part 1)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/14_mlr_model_building_2.html">
 <span class="dropdown-text">Multiple linear regression: model building (part 2)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-practice-problems" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Practice Problems</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-practice-problems">    
        <li>
    <a class="dropdown-item" href="../assignments/pp1.html">
 <span class="dropdown-text">Practice Problems 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/pp2.html">
 <span class="dropdown-text">Practice Problems 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/pp3.html">
 <span class="dropdown-text">Practice Problems 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/pp4.html">
 <span class="dropdown-text">Practice Problems 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/pp5.html">
 <span class="dropdown-text">Practice Problems 5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../project.html"> 
<span class="menu-text">Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../r_resources.html"> 
<span class="menu-text">R Resources</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#notes" id="toc-notes" class="nav-link active" data-scroll-target="#notes">Notes</a>
  <ul class="collapse">
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link" data-scroll-target="#learning-goals">Learning goals</a></li>
  <li><a href="#readings-and-videos" id="toc-readings-and-videos" class="nav-link" data-scroll-target="#readings-and-videos">Readings and videos</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul class="collapse">
  <li><a href="#exercise-1-modeling-bill-length-by-flipper-length" id="toc-exercise-1-modeling-bill-length-by-flipper-length" class="nav-link" data-scroll-target="#exercise-1-modeling-bill-length-by-flipper-length">Exercise 1: Modeling bill length by flipper length</a></li>
  <li><a href="#exercise-2-incorporating-body_mass_g" id="toc-exercise-2-incorporating-body_mass_g" class="nav-link" data-scroll-target="#exercise-2-incorporating-body_mass_g">Exercise 2: Incorporating <code>body_mass_g</code></a></li>
  <li><a href="#exercise-3-redundancy-and-multicollinearity" id="toc-exercise-3-redundancy-and-multicollinearity" class="nav-link" data-scroll-target="#exercise-3-redundancy-and-multicollinearity">Exercise 3: Redundancy and Multicollinearity</a></li>
  <li><a href="#exercise-4-considerations-for-strong-models" id="toc-exercise-4-considerations-for-strong-models" class="nav-link" data-scroll-target="#exercise-4-considerations-for-strong-models">Exercise 4: Considerations for strong models</a></li>
  <li><a href="#exercise-5-reflecting-on-these-investigations" id="toc-exercise-5-reflecting-on-these-investigations" class="nav-link" data-scroll-target="#exercise-5-reflecting-on-these-investigations">Exercise 5: Reflecting on these investigations</a></li>
  <li><a href="#exercise-6-overfitting" id="toc-exercise-6-overfitting" class="nav-link" data-scroll-target="#exercise-6-overfitting">Exercise 6: Overfitting</a></li>
  <li><a href="#exercise-7-questioning-r-squared" id="toc-exercise-7-questioning-r-squared" class="nav-link" data-scroll-target="#exercise-7-questioning-r-squared">Exercise 7: Questioning R-squared</a></li>
  <li><a href="#exercise-8-adjusted-r-squared" id="toc-exercise-8-adjusted-r-squared" class="nav-link" data-scroll-target="#exercise-8-adjusted-r-squared">Exercise 8: Adjusted R-squared</a></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection">Reflection</a></li>
  <li><a href="#render-your-work" id="toc-render-your-work" class="nav-link" data-scroll-target="#render-your-work">Render your work</a></li>
  </ul></li>
  <li><a href="#solutions" id="toc-solutions" class="nav-link" data-scroll-target="#solutions">Solutions</a>
  <ul class="collapse">
  <li><a href="#exercise-1-modeling-bill-length-by-flipper-length-1" id="toc-exercise-1-modeling-bill-length-by-flipper-length-1" class="nav-link" data-scroll-target="#exercise-1-modeling-bill-length-by-flipper-length-1">Exercise 1: Modeling bill length by flipper length</a></li>
  <li><a href="#exercise-2-incorporating-body_mass_g-1" id="toc-exercise-2-incorporating-body_mass_g-1" class="nav-link" data-scroll-target="#exercise-2-incorporating-body_mass_g-1">Exercise 2: Incorporating <code>body_mass_g</code></a></li>
  <li><a href="#exercise-3-redundancy-and-multicollinearity-1" id="toc-exercise-3-redundancy-and-multicollinearity-1" class="nav-link" data-scroll-target="#exercise-3-redundancy-and-multicollinearity-1">Exercise 3: Redundancy and Multicollinearity</a></li>
  <li><a href="#exercise-4-considerations-for-strong-models-1" id="toc-exercise-4-considerations-for-strong-models-1" class="nav-link" data-scroll-target="#exercise-4-considerations-for-strong-models-1">Exercise 4: Considerations for strong models</a></li>
  <li><a href="#exercise-5-reflecting-on-these-investigations-1" id="toc-exercise-5-reflecting-on-these-investigations-1" class="nav-link" data-scroll-target="#exercise-5-reflecting-on-these-investigations-1">Exercise 5: Reflecting on these investigations</a></li>
  <li><a href="#exercise-6-overfitting-1" id="toc-exercise-6-overfitting-1" class="nav-link" data-scroll-target="#exercise-6-overfitting-1">Exercise 6: Overfitting</a></li>
  <li><a href="#exercise-7-questioning-r-squared-1" id="toc-exercise-7-questioning-r-squared-1" class="nav-link" data-scroll-target="#exercise-7-questioning-r-squared-1">Exercise 7: Questioning R-squared</a></li>
  <li><a href="#exercise-8-adjusted-r-squared-1" id="toc-exercise-8-adjusted-r-squared-1" class="nav-link" data-scroll-target="#exercise-8-adjusted-r-squared-1">Exercise 8: Adjusted R-squared</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Multiple linear regression: model building (part 2)</h1>
<p class="subtitle lead">Notes and in-class exercises</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="notes" class="level1">
<h1>Notes</h1>
<ul>
<li>Slides to review our last topic are <a href="https://docs.google.com/presentation/d/13ko_LAeOJdQ2EejJC1DMtJhdzw0Wu2CuoNvnlbBbEBc/edit?usp=sharing">here</a>.</li>
<li>You can download a template file to work with <a href="../activity_templates/14_mlr_model_building_2.qmd">here</a>.</li>
<li><strong>File organization:</strong> Save this file in the “Activities” subfolder of your “STAT155” folder.</li>
</ul>
<section id="learning-goals" class="level2">
<h2 class="anchored" data-anchor-id="learning-goals">Learning goals</h2>
<p>By the end of this lesson, you should be able to:</p>
<ul>
<li>Explain when variables are redundant or multicollinear.</li>
<li>Relate redundancy and multicollinearity to coefficient estimates and <span class="math inline">\(R^2\)</span>.</li>
<li>Explain why adjusted <span class="math inline">\(R^2\)</span> is preferable to multiple <span class="math inline">\(R^2\)</span> when comparing models with different numbers of predictors.</li>
</ul>
</section>
<section id="readings-and-videos" class="level2">
<h2 class="anchored" data-anchor-id="readings-and-videos">Readings and videos</h2>
<p>Today is a day to discover ideas, so no readings or videos to go through before class, but if you want to see today’s ideas presented in a different way, you can take a look at the following after class:</p>
<ul>
<li>Reading: Section 3.9.5 in the <a href="https://mac-stat.github.io/Stat155Notes/">STAT 155 Notes</a></li>
<li>Video: <a href="https://voicethread.com/share/15177737/">Redundancy and Multicollinearity</a></li>
</ul>
</section>
</section>
<section id="exercises" class="level1">
<h1>Exercises</h1>
<p><strong>Context:</strong> Last time we talked about different types of research questions (descriptive, predictive, and causal) and worked through how to translate these questions to data explorations and modeling. Also recall that when we talked about model evaluation previously, we asked if the model was correct, strong, and fair.</p>
<p>Today we’ll revisit predictive research questions today and some considerations when trying to build <em>strong</em> models. In particular, we’ll consider nuances and limitations to indiscriminately adding more predictors to our model. To explore these ideas, we’ll explore data on physical characteristics of different penguin species:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can find a <strong>codebook</strong> for these data by typing <code>?penguins</code> <strong>in your console (not Rmd)</strong>. Our goal throughout will be to build a model of bill lengths (in mm):</p>
<p><img src="https://allisonhorst.github.io/palmerpenguins/reference/figures/culmen_depth.png" class="img-fluid"></p>
<p>(Art by <span class="citation" data-cites="allison_horst">@allison_horst</span>)</p>
<p>To get started, the <code>flipper_length_mm</code> variable currently measures flipper length in mm. Let’s create and save a <em>new</em> variable named <code>flipper_length_cm</code> which measures flipper length in cm. NOTE: There are 10mm in a cm.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">flipper_length_cm =</span> flipper_length_mm <span class="sc">/</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run the code chunk below to build a bunch of models that you’ll be exploring in the exercises:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>penguin_model_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bill_length_mm <span class="sc">~</span> flipper_length_mm, penguins)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>penguin_model_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bill_length_mm <span class="sc">~</span> flipper_length_cm, penguins)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>penguin_model_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bill_length_mm <span class="sc">~</span> flipper_length_mm <span class="sc">+</span> flipper_length_cm, penguins)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>penguin_model_4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bill_length_mm <span class="sc">~</span> body_mass_g, penguins)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>penguin_model_5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bill_length_mm <span class="sc">~</span> flipper_length_mm <span class="sc">+</span> body_mass_g, penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exercise-1-modeling-bill-length-by-flipper-length" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1-modeling-bill-length-by-flipper-length">Exercise 1: Modeling bill length by flipper length</h2>
<p>What can a penguin’s flipper (arm) length tell us about their bill length? To answer this question, we’ll consider 3 of our models:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: left;">predictors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>penguin_model_1</code></td>
<td style="text-align: left;"><code>flipper_length_mm</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>penguin_model_2</code></td>
<td style="text-align: left;"><code>flipper_length_cm</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>penguin_model_3</code></td>
<td style="text-align: left;"><code>flipper_length_mm + flipper_length_cm</code></td>
</tr>
</tbody>
</table>
<p>Plots of the first two models are below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">y =</span> bill_length_mm, <span class="at">x =</span> flipper_length_mm)) <span class="sc">+</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">y =</span> bill_length_mm, <span class="at">x =</span> flipper_length_cm)) <span class="sc">+</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="a">
<li><p><em>Before</em> examining the model summaries, check your intuition. Do you think the <code>penguin_model_2</code> R-squared will be less than, equal to, or more than that of <code>penguin_model_1</code>? Similarly, how do you think the <code>penguin_model_3</code> R-squared will compare to that of <code>penguin_model_1</code>?</p></li>
<li><p>Check your intuition: Examine the R-squared values for the three penguin models and summarize how these compare.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(penguin_model_1)<span class="sc">$</span>r.squared</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(penguin_model_2)<span class="sc">$</span>r.squared</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(penguin_model_3)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="a">
<li>Explain why your observation in part b makes sense. Support your reasoning with a plot of just the 2 <em>predictors</em>: <code>flipper_length_mm</code> vs <code>flipper_length_cm</code>.</li>
</ol>
<ol start="4" type="a">
<li><em>OPTIONAL challenge:</em> In <code>summary(penguin_model_3)</code>, the <code>flipper_length_cm</code> coefficient is <code>NA</code>. Explain why this makes sense. HINT: Thinking about what you learned about controlling for covariates, why wouldn’t it make sense to interpret this coefficient? BONUS: For those of you that have taken MATH 236, this has to do with matrices that are not of full rank!</li>
</ol>
</section>
<section id="exercise-2-incorporating-body_mass_g" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2-incorporating-body_mass_g">Exercise 2: Incorporating <code>body_mass_g</code></h2>
<p>In this exercise you’ll consider 3 models of <code>bill_length_mm</code>:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: left;">predictors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>penguin_model_1</code></td>
<td style="text-align: left;"><code>flipper_length_mm</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>penguin_model_4</code></td>
<td style="text-align: left;"><code>body_mass_g</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>penguin_model_5</code></td>
<td style="text-align: left;"><code>flipper_length_mm + body_mass_g</code></td>
</tr>
</tbody>
</table>
<ol type="a">
<li><p>Which is the better predictor of <code>bill_length_mm</code>: <code>flipper_length_mm</code> or <code>body_mass_g</code>? Provide some numerical evidence.</p></li>
<li><p><code>penguin_model_5</code> incorporates both <code>flipper_length_mm</code> and <code>body_mass_g</code> as predictors. <em>Before</em> examining a model summary, ask your gut: Will the <code>penguin_model_5</code> R-squared be close to 0.35, close to 0.43, or greater than 0.6?</p></li>
<li><p>Check your intuition. Report the <code>penguin_model_5</code> R-squared and summarize how this compares to that of <code>penguin_model_1</code> and <code>penguin_model_4</code>.</p></li>
<li><p>Explain why your observation in part c makes sense. Support your reasoning with a plot of the 2 <em>predictors</em>: <code>flipper_length_mm</code> vs <code>body_mass_g</code>.</p></li>
</ol>
</section>
<section id="exercise-3-redundancy-and-multicollinearity" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3-redundancy-and-multicollinearity">Exercise 3: Redundancy and Multicollinearity</h2>
<p>The exercises above have illustrated special phenomena in multivariate modeling:</p>
<ul>
<li>two predictors are <strong>redundant</strong> if they contain the same exact information</li>
<li>two predictors are <strong>multicollinear</strong> if they are strongly associated (they contain very similar information) but are not completely redundant.</li>
</ul>
<p>Recall that we examined 5 models:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: left;">predictors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>penguin_model_1</code></td>
<td style="text-align: left;"><code>flipper_length_mm</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>penguin_model_2</code></td>
<td style="text-align: left;"><code>flipper_length_cm</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>penguin_model_3</code></td>
<td style="text-align: left;"><code>flipper_length_mm + flipper_length_cm</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>penguin_model_4</code></td>
<td style="text-align: left;"><code>body_mass_g</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>penguin_model_5</code></td>
<td style="text-align: left;"><code>flipper_length_mm + body_mass_g</code></td>
</tr>
</tbody>
</table>
<ol type="a">
<li>Which model had <em>redundant</em> predictors and which predictors were these?</li>
<li>Which model had <em>multicollinear</em> predictors and which predictors were these?</li>
<li>In general, what happens to the R-squared value if we add a <em>redundant</em> predictor to a model: will it decrease, stay the same, increase by a small amount, or increase by a significant amount?</li>
<li>Similarly, what happens to the R-squared value if we add a <em>multicollinear</em> predictor to a model: will it decrease, stay the same, increase by a small amount, or increase by a significant amount?</li>
</ol>
</section>
<section id="exercise-4-considerations-for-strong-models" class="level2">
<h2 class="anchored" data-anchor-id="exercise-4-considerations-for-strong-models">Exercise 4: Considerations for strong models</h2>
<p>Let’s dive deeper into important considerations when building a <em>strong</em> model. We’ll use a subset of the penguins data for exploring these ideas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For illustration purposes only, take a sample of 10 penguins.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll discuss this code later in the course!</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">155</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>penguins_small <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(penguins, <span class="at">size =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">flipper_length_mm =</span> <span class="fu">jitter</span>(flipper_length_mm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Consider 3 models of bill length:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A model with one predictor (flipper_length_mm)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>poly_mod_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bill_length_mm <span class="sc">~</span> flipper_length_mm, penguins_small)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># A model with two predictors (flipper_length_mm and flipper_length_mm^2)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>poly_mod_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bill_length_mm <span class="sc">~</span> <span class="fu">poly</span>(flipper_length_mm, <span class="dv">2</span>), penguins_small)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># A model with nine predictors (flipper_length_mm, flipper_length_mm^2, ... on up to flipper_length_mm^9)</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>poly_mod_9 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bill_length_mm <span class="sc">~</span> <span class="fu">poly</span>(flipper_length_mm, <span class="dv">9</span>), penguins_small)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="a">
<li>Before doing any analysis, which of the three models do you think will be best?</li>
<li>Calculate the R-squared values of these 3 models. Which model do you think is best?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poly_mod_1)<span class="sc">$</span>r.squared</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poly_mod_2)<span class="sc">$</span>r.squared</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poly_mod_9)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="a">
<li>Check out plots depicting the relationship estimated by these 3 models. Which model do you think is best?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A plot of model 1</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins_small, <span class="fu">aes</span>(<span class="at">y =</span> bill_length_mm, <span class="at">x =</span> flipper_length_mm)) <span class="sc">+</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A plot of model 2</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins_small, <span class="fu">aes</span>(<span class="at">y =</span> bill_length_mm, <span class="at">x =</span> flipper_length_mm)) <span class="sc">+</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">2</span>), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A plot of model 9</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins_small, <span class="fu">aes</span>(<span class="at">y =</span> bill_length_mm, <span class="at">x =</span> flipper_length_mm)) <span class="sc">+</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">9</span>), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exercise-5-reflecting-on-these-investigations" class="level2">
<h2 class="anchored" data-anchor-id="exercise-5-reflecting-on-these-investigations">Exercise 5: Reflecting on these investigations</h2>
<ol type="a">
<li>List 3 of your favorite foods. Now imagine making a dish that combines all of these foods. Do you think it would taste good?</li>
<li>Too many good things doesn’t make necessarily make a better thing. Model 9 demonstrates that it’s always <em>possible</em> to get a perfect R-squared of 1, but there are drawbacks to putting more and more predictors into our model. Answer the following about model 9:
<ul>
<li>How easy would it be to interpret this model?</li>
<li>Would you say that this model captures the general trend of the relationship between <code>bill_length_mm</code> and <code>flipper_length_mm</code>?</li>
<li>How well do you think this model would generalize to penguins that were not included in the <code>penguins_small</code> sample? For example, would you expect these new penguins to fall on the wiggly model 9 curve?</li>
</ul></li>
</ol>
</section>
<section id="exercise-6-overfitting" class="level2">
<h2 class="anchored" data-anchor-id="exercise-6-overfitting">Exercise 6: Overfitting</h2>
<p>Model 9 provides an example of a model that is <strong>overfit</strong> to our sample data. That is, it picks up the tiny details of our data at the cost of losing the more general trends of the relationship of interest. Check out the following <a href="https://xkcd.com/2048/">xkcd comic</a>. Which plot pokes fun at overfitting?</p>
<p><img src="https://imgs.xkcd.com/comics/curve_fitting_2x.png" class="img-fluid"></p>
<p>Some other goodies:</p>
<p><img src="https://pbs.twimg.com/media/EbI7FNxX0AU_gIR.jpg" class="img-fluid"></p>
<p><img src="https://miro.medium.com/max/800/1*cT-z5lx-c0phjaw-iVUxvA.jpeg" class="img-fluid"></p>
</section>
<section id="exercise-7-questioning-r-squared" class="level2">
<h2 class="anchored" data-anchor-id="exercise-7-questioning-r-squared">Exercise 7: Questioning R-squared</h2>
<p>Zooming out, explain some limitations of relying on R-squared to measure the strength / usefulness of a model.</p>
</section>
<section id="exercise-8-adjusted-r-squared" class="level2">
<h2 class="anchored" data-anchor-id="exercise-8-adjusted-r-squared">Exercise 8: Adjusted R-squared</h2>
<p>We’ve seen that, unless a predictor is redundant with another, R-squared will increase. Even if that predictor is strongly multicollinear with another. Even if that predictor isn’t a good predictor! Thus if we only look at R-squared we might get overly greedy. We can check our greedy impulses a few ways. We take a more in depth approach in STAT 253, but one quick alternative is reported right in our model <code>summary()</code> tables. <strong>Adjusted R-squared</strong> includes a <em>penalty</em> for incorporating more and more predictors. Mathematically (where <span class="math inline">\(n\)</span> is the sample size and <span class="math inline">\(p\)</span> is the number of non-intercept coefficients):</p>
<p><span class="math display">\[
\text{Adjusted } R^2 = 1 - (1 - R^2) \left( \frac{n-1}{n-p-1} \right)
\]</span></p>
<p>Thus unlike R-squared, Adjusted R-squared can <em>decrease</em> when the information that a predictor contributes to a model isn’t enough to offset the complexity it adds to that model. Consider two models:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>example_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bill_length_mm <span class="sc">~</span> species, penguins)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>example_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bill_length_mm <span class="sc">~</span> species <span class="sc">+</span> island, penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="a">
<li>Check out the summaries for the 2 example models. In general, how does a model’s Adjusted R-squared compare to the R-squared? Is it greater, less than, or equal to the R-squared?</li>
<li>How did the R-squared change from example model 1 to model 2? How did the Adjusted R-squared change?</li>
<li>Explain what it is about <code>island</code> that resulted in a decreased Adjusted R-squared. Note: it’s not necessarily the case that <code>island</code> is a bad predictor on its own!</li>
</ol>
</section>
<section id="reflection" class="level2">
<h2 class="anchored" data-anchor-id="reflection">Reflection</h2>
<p>Today we looked at some cautions surrounding indiscriminately adding variables to a model. Summarize key takeaways.</p>
<blockquote class="blockquote">
<p><strong>Response:</strong> Put your response here.</p>
</blockquote>
</section>
<section id="render-your-work" class="level2">
<h2 class="anchored" data-anchor-id="render-your-work">Render your work</h2>
<ul>
<li>Click the “Render” button in the menu bar for this pane (blue arrow pointing right). This will create an HTML file containing all of the directions, code, and responses from this activity. A preview of the HTML will appear in the browser.</li>
<li>Scroll through and inspect the document to check that your work translated to the HTML format correctly.</li>
<li>Close the browser tab.</li>
<li>Go to the “Background Jobs” pane in RStudio and click the Stop button to end the rendering process.</li>
<li>Navigate to your “Activities” subfolder within your “STAT155” folder and locate the HTML file. You can open it again in your browser to double check.</li>
</ul>
<p><br><br><br><br><br><br></p>
</section>
</section>
<section id="solutions" class="level1">
<h1>Solutions</h1>
<section id="exercise-1-modeling-bill-length-by-flipper-length-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1-modeling-bill-length-by-flipper-length-1">Exercise 1: Modeling bill length by flipper length</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: left;">predictors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>penguin_model_1</code></td>
<td style="text-align: left;"><code>flipper_length_mm</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>penguin_model_2</code></td>
<td style="text-align: left;"><code>flipper_length_cm</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>penguin_model_3</code></td>
<td style="text-align: left;"><code>flipper_length_mm + flipper_length_cm</code></td>
</tr>
</tbody>
</table>
<p>Plots of the first two models are below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">y =</span> bill_length_mm, <span class="at">x =</span> flipper_length_mm)) <span class="sc">+</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="14_mlr_model_building_2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">y =</span> bill_length_mm, <span class="at">x =</span> flipper_length_cm)) <span class="sc">+</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range (`stat_smooth()`).
Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="14_mlr_model_building_2_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol type="a">
<li><p>Your intuition–answers will vary</p></li>
<li><p>The R-squared values are all the same!</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(penguin_model_1)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.430574</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(penguin_model_2)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.430574</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(penguin_model_3)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.430574</code></pre>
</div>
</div>
<ol start="3" type="a">
<li>The two variables are perfectly linearly correlated—they contain exactly the same information!</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_cm, <span class="at">y =</span> flipper_length_mm)) <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="14_mlr_model_building_2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="a">
<li>An <code>NA</code> means that the coefficient couldn’t be estimated. In <code>penguin_model_3</code>, the interpretation of the <code>flipper_length_cm</code> coefficient is the average change in bill length per centimeter change in flipper length, while holding flipper length in millimeters constant…this is impossible! We can’t hold flipper length in millimeters fixed while varying flipper length in centimeters—if one changes the other must. (In linear algebra terms, the matrix underlying our data is not of full rank.)</li>
</ol>
</section>
<section id="exercise-2-incorporating-body_mass_g-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2-incorporating-body_mass_g-1">Exercise 2: Incorporating <code>body_mass_g</code></h2>
<p>In this exercise you’ll consider 3 models of <code>bill_length_mm</code>:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: left;">predictors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>penguin_model_1</code></td>
<td style="text-align: left;"><code>flipper_length_mm</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>penguin_model_4</code></td>
<td style="text-align: left;"><code>body_mass_g</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>penguin_model_5</code></td>
<td style="text-align: left;"><code>flipper_length_mm + body_mass_g</code></td>
</tr>
</tbody>
</table>
<ol type="a">
<li><p><code>flipper_length_mm</code> is a better predictor than <code>body_mass_g</code> because <code>penguin_model_1</code> has an R-squared value of 0.4306 vs 0.3542 for <code>penguin_model_4</code>.</p></li>
<li><p>Intuition check–answers will vary</p></li>
<li><p>R-squared is for <code>penguin_model_5</code> which is slightly higher than that of <code>penguin_model_1</code> and <code>penguin_model_4</code>.</p></li>
</ol>
<p>d.<code>flipper_length_mm</code> and <code>body_mass_g</code> are positively correlated and thus contain related information, but not completely redundant information. There’s some information in flipper length in explaining bill length that isn’t captured by body mass, and vice-versa.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> body_mass_g)) <span class="sc">+</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="14_mlr_model_building_2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="exercise-3-redundancy-and-multicollinearity-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3-redundancy-and-multicollinearity-1">Exercise 3: Redundancy and Multicollinearity</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: left;">predictors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>penguin_model_1</code></td>
<td style="text-align: left;"><code>flipper_length_mm</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>penguin_model_2</code></td>
<td style="text-align: left;"><code>flipper_length_cm</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>penguin_model_3</code></td>
<td style="text-align: left;"><code>flipper_length_mm + flipper_length_cm</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>penguin_model_4</code></td>
<td style="text-align: left;"><code>body_mass_g</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>penguin_model_5</code></td>
<td style="text-align: left;"><code>flipper_length_mm + body_mass_g</code></td>
</tr>
</tbody>
</table>
<ol type="a">
<li><code>penguin_model_3</code> had <em>redundant</em> predictors: `<code>flipper_length_mm</code> and <code>flipper_length_cm</code></li>
<li><code>penguin_model_5</code> had <em>multicollinear</em> predictors: <code>flipper_length_mm</code> and <code>body_mass_g</code> were related but not redundant</li>
<li>R-squared will stay the same if we add a <em>redundant</em> predictor to a model.</li>
<li>R-squared will increase by a small amount if we add a <em>multicollinear</em> predictor to a model.</li>
</ol>
</section>
<section id="exercise-4-considerations-for-strong-models-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-4-considerations-for-strong-models-1">Exercise 4: Considerations for strong models</h2>
<ol type="a">
<li>A gut check! Answers will vary</li>
<li>Based on R-squared: recall that R-squared is interpreted as the proportion of variation in the outcome that our model explains. It would seem that higher is better, so <code>poly_mod_9</code> might seem to be the best. BUT we’ll see where this reasoning is flawed soon!</li>
<li>Based on the plots: Answers will vary</li>
</ol>
</section>
<section id="exercise-5-reflecting-on-these-investigations-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-5-reflecting-on-these-investigations-1">Exercise 5: Reflecting on these investigations</h2>
<ol type="a">
<li>salmon, chocolate, samosas. Together? Yuck!</li>
<li>Regarding model 9:
<ul>
<li>NOT easy to interpret.</li>
<li>NO. It’s much more wiggly than the general trend.</li>
<li>NOT WELL. It is too tailored to our data.</li>
</ul></li>
</ol>
</section>
<section id="exercise-6-overfitting-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-6-overfitting-1">Exercise 6: Overfitting</h2>
<p>The bottom left plot pokes fun at overfitting.</p>
<p><img src="https://imgs.xkcd.com/comics/curve_fitting_2x.png" class="img-fluid"></p>
</section>
<section id="exercise-7-questioning-r-squared-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-7-questioning-r-squared-1">Exercise 7: Questioning R-squared</h2>
<p>It measures how well our model explains / predicts <em>our</em> sample data, not how well it explains / predicts the broader population. It also has the feature that <em>any non-redundant</em> predictor added to a model will increase the R-squared.</p>
</section>
<section id="exercise-8-adjusted-r-squared-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-8-adjusted-r-squared-1">Exercise 8: Adjusted R-squared</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>example_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bill_length_mm <span class="sc">~</span> species, penguins)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>example_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bill_length_mm <span class="sc">~</span> species <span class="sc">+</span> island, penguins)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(example_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bill_length_mm ~ species, data = penguins)

Residuals:
    Min      1Q  Median      3Q     Max 
-7.9338 -2.2049  0.0086  2.0662 12.0951 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       38.7914     0.2409  161.05   &lt;2e-16 ***
speciesChinstrap  10.0424     0.4323   23.23   &lt;2e-16 ***
speciesGentoo      8.7135     0.3595   24.24   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.96 on 339 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.7078,    Adjusted R-squared:  0.7061 
F-statistic: 410.6 on 2 and 339 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(example_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bill_length_mm ~ species + island, data = penguins)

Residuals:
    Min      1Q  Median      3Q     Max 
-7.9338 -2.2049 -0.0049  2.0951 12.0951 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      38.97500    0.44697  87.198   &lt;2e-16 ***
speciesChinstrap 10.33204    0.53502  19.312   &lt;2e-16 ***
speciesGentoo     8.52988    0.52082  16.378   &lt;2e-16 ***
islandDream      -0.47321    0.59729  -0.792    0.429    
islandTorgersen  -0.02402    0.61004  -0.039    0.969    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.965 on 337 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.7085,    Adjusted R-squared:  0.7051 
F-statistic: 204.8 on 4 and 337 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<ol type="a">
<li>Adjusted R-squared is less than the R-squared</li>
<li>From model 1 to 2, R-squared increased and Adjusted R-squared decreased.</li>
<li><code>island</code> didn’t provide useful information about bill length beyond what was already provided by species.</li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Leslie Myint, 2024<br> All content licensed under <img src="https://static.thenounproject.com/png/70967-200.png" height="20"> (<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>)</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Site built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>